<!-- Zelfde header/nav als hierboven -->
<section>
  <h2>Betalen voor je bestelling</h2>
  <p>Je betaalt het totaalbedrag inclusief verzendkosten.</p>
  <div class="totaal" id="totaalbedrag">Totaal: €0,00</div>
  <a id="betaallink" href="#" target="_blank" class="betaalknop">Betaal nu</a>
</section>

<script>
  const mand = JSON.parse(localStorage.getItem("winkelmand")) || [];
  if (mand.length === 0) {
    alert("Je winkelmand is leeg.");
    window.location.href = "producten.html";
  }

  let totaal = 0;
  mand.forEach(item => totaal += item.prijs);
  const verzendkosten = 4.95;
  const totaalMetVerzending = totaal + verzendkosten;
  const bedrag = totaalMetVerzending.toFixed(2);

  document.getElementById("totaalbedrag").textContent = `Totaal (incl. verzending): €${bedrag}`;
  document.getElementById("betaallink").href = `https://payrequest.io/pay/dkpikebaits?amount=${bedrag}`;
  document.getElementById("betaallink").textContent = `Betaal €${bedrag} met iDEAL`;

  // Bestelling opslaan
  const db = firebase.firestore();
  db.collection("bestellingen").add({
    naam: "Onbekend", // later uitbreiden met naamveld
    producten: mand,
    totaal: totaalMetVerzending,
    datum: new Date().toISOString()
  });

  // Voorraad bijwerken
  mand.forEach(item => {
    const ref = db.collection("producten").doc(item.id);
    ref.update({ voorraad: firebase.firestore.FieldValue.increment(-1) });
  });

  localStorage.removeItem("winkelmand");
</script>
