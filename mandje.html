<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Mandje</title>
</head>
<body>

<h1>Winkelmand</h1>
<div id="cart"></div>
<button id="checkout">Afrekenen</button>

<script src="https://js.stripe.com/v3/"></script>
<script>
const stripe = Stripe("pk_test_51ShbijDKBwjX9ElPpXBRbO4BjbScRaXuaxNQeKeDF50Isnyw00K8a79HvgsU3JVkeWfdaai0Z1NpjV5uKXfjF6w700Mp1j02QU");

const cart = JSON.parse(localStorage.getItem("cart")) || [];
const cartDiv = document.getElementById("cart");

let totaal = 0;
cart.forEach(item => {
  totaal += item.price * item.quantity;
  cartDiv.innerHTML += `<p>${item.name} – €${item.price / 100}</p>`;
});

cartDiv.innerHTML += `<hr><strong>Totaal: €${totaal / 100}</strong><br>Verzendkosten: €4,50`;

document.getElementById("checkout").onclick = async () => {
  const res = await fetch("/create-checkout-session", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ items: cart })
  });

  const data = await res.json();
  window.location.href = data.url;
};
</script>

</body>
</html>
